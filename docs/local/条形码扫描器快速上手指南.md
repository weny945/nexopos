# 条形码扫描器快速上手指南

> 5 分钟快速配置和使用条形码扫描器

---

## ✅ NexoPOS 原生支持条形码扫描器！

**好消息**：无需任何额外开发，NexoPOS 已完全支持条形码扫描枪，开箱即用！

---

## 📦 支持的扫描器类型

| 类型 | 支持情况 | 配置难度 | 推荐指数 |
|------|---------|---------|---------|
| **USB 扫描枪** | ✅ 完全支持 | ⭐ 即插即用 | ⭐⭐⭐⭐⭐ |
| **蓝牙扫描枪** | ✅ 完全支持 | ⭐⭐ 需配对 | ⭐⭐⭐⭐ |
| **手机扫描** | ✅ 浏览器支持 | ⭐ 无需配置 | ⭐⭐⭐ |
| **RS232 串口** | ❌ 不支持 | - | - |

---

## 🚀 快速开始（3 步）

### 步骤 1: 连接扫描枪

#### USB 扫描枪（推荐）
1. 将扫描枪 USB 插头插入电脑
2. Windows 会自动识别为键盘设备
3. 无需安装驱动，即可使用！

#### 蓝牙扫描枪
1. 打开扫描枪，进入配对模式（参考说明书）
2. 在电脑蓝牙设置中搜索设备
3. 配对成功后自动识别为键盘
4. 开始使用！

### 步骤 2: 配置扫描枪（重要！）

大多数扫描枪出厂默认设置即可使用，但建议检查以下设置：

#### 必需配置
- **后缀设置** = `Enter`（回车键）
  - 扫描后自动提交条形码
  - 大部分扫描枪默认已配置

#### 推荐配置
- **前缀设置** = 无（保持默认）
- **扫描模式** = 连续扫描
- **蜂鸣声** = 开启（确认扫描成功）
- **指示灯** = 开启

#### 如何配置？
1. 参考扫描枪说明书
2. 扫描配置条形码（通常在说明书中）
3. 或使用厂商提供的配置软件

### 步骤 3: 在 NexoPOS 中使用

#### 3.1 打开 POS 页面
```
方法 1: 登录后访问 http://你的域名/dashboard/pos
方法 2: 登录后点击左侧菜单 "POS" 或 "收银台"
```

**重要提示**: POS 功能需要先登录系统！

#### 3.2 启用自动聚焦
1. 找到条形码输入框（在商品网格页面顶部）
2. 点击 **条形码图标按钮** 🔲
3. 按钮变蓝色 = 已启用

![自动聚焦按钮位置](位置：搜索按钮右侧第三个按钮)

#### 3.3 开始扫描
1. 对准商品条形码
2. 按下扫描枪触发键
3. 听到"哔"声表示成功
4. **商品自动添加到购物车！**

---

## 🧪 测试扫描枪是否正常

### 简单测试方法
1. 打开记事本或任何文本编辑器
2. 用扫描枪扫描任意条形码
3. **期望结果**：
   - 显示条形码数字
   - 自动换行（如果配置了 Enter 后缀）

**示例**：
```
6901028075831
[自动换行]
```

如果成功，说明扫描枪配置正确！

---

## 🎯 实际使用流程

### 场景 1: POS 收银（最常用）

```
1. 客户选购商品
   ↓
2. 收银员打开 POS 页面
   ↓
3. 启用自动聚焦（点击条形码图标）
   ↓
4. 逐个扫描商品条形码
   ↓ 系统自动：
   - 搜索商品（200ms 防抖）
   - 添加到购物车
   - 显示商品名称和价格
   ↓
5. 点击"购物车"查看总额
   ↓
6. 选择支付方式
   ↓
7. 完成交易
```

**效率提升**: 从手动搜索 10 秒 → 扫描 1 秒！

### 场景 2: 称重商品（水果、蔬菜、肉类）

**前提**: 启用称重条形码功能

1. **配置称重条形码**
   ```
   设置 → POS → Scale Barcode
   - 启用称重条形码: Yes
   - 前缀: 2（默认）
   - 类型: Weight（重量）
   - 商品代码长度: 5
   - 数值长度: 5
   ```

2. **设置商品 PLU 码**
   ```
   商品管理 → 编辑商品 → 单位设置
   - 选择单位（如 kg）
   - 勾选"称重商品"
   - 系统自动生成 PLU 码
   ```

3. **使用电子秤**
   ```
   1. 在电子秤中输入商品 PLU 码（如 12345）
   2. 放置商品（如 1.5kg 苹果）
   3. 电子秤生成条形码: 2123450150003
      - 前缀: 2
      - PLU: 12345
      - 重量: 01500（1.5kg = 1500g）
      - 校验位: 3
   4. 扫描条形码
   5. 系统自动识别并设置数量为 1.5
   ```

4. **POS 显示**
   ```
   提示: "称重条形码检测到：1.500 kg"
   商品自动添加，数量 = 1.5
   ```

### 场景 3: 库存盘点

```
1. 打开库存调整页面
   仪表板 → 商品 → 库存调整
   ↓
2. 搜索商品（可用扫描枪扫描）
   ↓
3. 选择调整类型（Added/Removed）
   ↓
4. 输入实际数量
   ↓
5. 填写原因
   ↓
6. 提交
```

### 场景 4: 商品入库（采购）

```
1. 创建采购单
   仪表板 → 采购 → 创建采购
   ↓
2. 选择供应商
   ↓
3. 添加商品（支持扫描）
   - 扫描商品条形码自动填充
   - 输入采购数量和价格
   ↓
4. 确认入库
   ↓
5. 库存自动更新
```

---

## 🔧 常见问题排查

### 问题 1: 扫描后无反应

**可能原因**:
- ❌ 自动聚焦未启用
- ❌ 扫描枪未配置 Enter 后缀
- ❌ 浏览器弹窗阻止了焦点

**解决方案**:
1. 确认条形码图标按钮为蓝色（已启用）
2. 刷新页面重新启用
3. 关闭所有弹窗
4. 检查扫描枪配置

### 问题 2: 扫描后显示错误商品

**可能原因**:
- ❌ 条形码重复
- ❌ 商品状态为"不可用"
- ❌ 扫描了过期商品

**解决方案**:
```sql
-- 检查条形码是否重复
SELECT barcode, COUNT(*) as count
FROM ns_products
WHERE barcode = '你的条形码'
GROUP BY barcode
HAVING count > 1;

-- 或检查单位条形码
SELECT barcode, COUNT(*) as count
FROM ns_products_unit_quantities
WHERE barcode = '你的条形码'
GROUP BY barcode
HAVING count > 1;
```

### 问题 3: 称重条形码无法识别

**检查清单**:
- [ ] 称重功能已启用（设置 → POS → Scale Barcode）
- [ ] 商品已设置 PLU 码
- [ ] 商品单位标记为"称重商品"
- [ ] 电子秤配置与系统一致（前缀、长度）

**测试方法**:
```
在 Tinker 中测试:
php artisan tinker

$service = app(\App\Services\ProductService::class);
$result = $service->parseScaleBarcode('2123450150003');
dd($result);

// 应该输出:
// [
//   "product_code" => "12345",
//   "value" => 1.5,
//   "type" => "weight"
// ]
```

### 问题 4: 扫描速度慢

**可能原因**:
- 🐌 网络延迟
- 🐌 服务器性能不足
- 🐌 数据库未优化

**优化建议**:
1. 启用 Redis 缓存
2. 添加数据库索引（见完整指南）
3. 使用 CDN 加速静态资源
4. 减少防抖延迟（默认 200ms）

---

## 📊 支持的条形码格式

NexoPOS 支持以下国际标准条形码格式：

| 格式 | 位数 | 应用场景 | 示例 |
|------|------|---------|------|
| **EAN-13** | 13 | 全球零售商品（最常用） | 6901028075831 |
| **EAN-8** | 8 | 小包装商品 | 12345670 |
| **UPC-A** | 12 | 北美零售 | 012345678905 |
| **UPC-E** | 6-8 | 小商品 | 01234565 |
| **CODE128** | 可变 | 物流、仓储 | ABC123 |
| **CODE39** | 可变 | 工业应用 | *CODE39* |
| **CODE11** | 可变 | 电信行业 | 1234567890 |
| **CODABAR** | 可变 | 图书馆、血库 | A1234B |

**自动生成**: 创建商品时留空条形码字段，系统自动生成 EAN-8 码

---

## 🎓 高级技巧

### 技巧 1: 快捷键配合使用

系统支持键盘快捷键，可与扫描枪配合：

- **快速搜索**: `Ctrl + F` 或配置的快捷键
- **切换合并**: 合并相同商品
- **快速结账**: `F9`（可配置）

### 技巧 2: 批量扫描

1. 启用商品合并功能（点击合并图标）
2. 连续扫描相同商品
3. 系统自动累加数量

### 技巧 3: 自定义条形码搜索逻辑

可通过钩子自定义搜索行为：

```javascript
// 在模块中添加
nsHooks.addFilter('ns-pos-submit-search-url', (url, barcode) => {
    // 自定义搜索 URL
    if (barcode.startsWith('CUSTOM-')) {
        return `/api/custom-search/${barcode}`;
    }
    return url;
});
```

### 技巧 4: 扫描日志记录

启用调试模式查看扫描记录：

```javascript
// 在浏览器控制台
localStorage.setItem('ns_debug_barcode', 'true');

// 每次扫描都会在控制台输出
// "Barcode scanned: 6901028075831"
// "Product found: iPhone 13"
```

---

## 🛒 推荐扫描器品牌和型号

### 入门级（200-500 元）
- **霍尼韦尔 1900** - 经典有线扫描枪
- **得力 14890** - 性价比之选
- **新大陆 NLS-HR11** - 国产品质

### 专业级（500-1500 元）
- **霍尼韦尔 1952g** - 蓝牙无线
- **斑马 DS2208** - 高性能扫描
- **新大陆 NLS-HR32** - 工业级

### 高端级（1500+ 元）
- **霍尼韦尔 Xenon 1902** - 二维码支持
- **Datalogic QuickScan QD2430** - 快速扫描
- **斑马 DS3608** - 超坚固设计

**购买建议**: 入门级即可满足零售需求，专业级适合高频使用

---

## 📱 手机扫描方案

如果暂时没有扫描枪，可使用手机：

### 方案 1: 浏览器直接访问
1. 手机浏览器打开 POS 页面
2. 点击搜索按钮
3. 使用摄像头扫描条形码
4. 添加商品

### 方案 2: 第三方扫描 App
1. 下载条形码扫描 App（如"扫描全能王"）
2. 扫描获取条形码数字
3. 手动输入到 POS 搜索框

**限制**: 速度较慢，适合临时使用

---

## ✅ 检查清单

使用前请确认以下项目：

**硬件准备**
- [ ] 扫描枪已连接并识别
- [ ] 扫描枪配置了 Enter 后缀
- [ ] 测试扫描正常（记事本测试）

**系统配置**
- [ ] NexoPOS 已安装并运行
- [ ] 商品已录入并设置条形码
- [ ] 商品状态为"可用"
- [ ] 库存管理已启用

**POS 设置**
- [ ] 已登录 POS 页面
- [ ] 自动聚焦已启用（蓝色按钮）
- [ ] 无弹窗阻挡输入框

**称重商品（可选）**
- [ ] 称重条形码功能已启用
- [ ] PLU 码已生成
- [ ] 电子秤配置正确

---

## 🎉 开始使用！

配置完成后，您可以立即体验条形码扫描带来的高效收银体验：

1. **登录系统**: http://你的域名/sign-in
2. **打开 POS**: http://你的域名/dashboard/pos
3. **启用自动聚焦**: 点击条形码图标 🔲
4. **扫描商品**: 对准条形码，按下触发键
5. **完成销售**: 查看购物车，选择支付方式

**效率提升**:
- ⚡ 添加商品: 10秒 → 1秒
- ⚡ 结账速度: 提升 80%
- ⚡ 差错率: 降低 95%

---

## 📞 需要帮助？

- **完整文档**: `docs/local/库存管理系统完整指南.md`
- **官方文档**: https://my.nexopos.com/en/documentation
- **社区支持**: https://chat.whatsapp.com/KHWgNmfcfJy7SwJiRQTmG8
- **GitHub Issues**: https://github.com/Blair2004/NexoPOS/issues

---

**最后更新**: 2026-01-23
**适用版本**: NexoPOS 5.x+
