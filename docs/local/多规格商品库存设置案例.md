# NexoPOS 多规格商品库存设置案例

## 案例：可口可乐不同规格包装

### 问题描述

可口可乐有多种规格，每种规格的装箱数量不同：
- 330ML 听装：24听/箱
- 500ML 瓶装：24瓶/箱
- 2L 瓶装：8瓶/箱

**如何设置库存？**

## 🎯 方案一：创建不同的单位组（推荐）

### 核心思路

**不同装箱规格 = 不同单位组**

因为：
- 330ML 的箱（24听）和 2L 的箱（8瓶）是**不同的计量单位**
- 它们不能共用同一个"箱"单位
- 需要创建独立的单位组来区分

### 第一步：创建单位组

#### 单位组 1：小规格装箱组（24件/箱）

```
访问：仪表板 → 库存 → 单位组 → 创建

名称：计数单位组-24装
描述：适用于 24 件/箱的商品（330ML、500ML）
```

**创建单位：**
```
单位 1：件
├─ 标识符：PIECE
├─ 基础单位：✓ 是
└─ 换算值：1

单位 2：箱（24件装）
├─ 标识符：BOX24
├─ 基础单位：✗ 否
└─ 换算值：24
```

#### 单位组 2：大规格装箱组（8件/箱）

```
访问：仪表板 → 库存 → 单位组 → 创建

名称：计数单位组-8装
描述：适用于 8 件/箱的商品（2L 大瓶）
```

**创建单位：**
```
单位 1：件
├─ 标识符：PIECE_2L
├─ 基础单位：✓ 是
└─ 换算值：1

单位 2：箱（8件装）
├─ 标识符：BOX8
├─ 基础单位：✗ 否
└─ 换算值：8
```

### 第二步：创建商品

#### 商品 1：可口可乐 330ML

```
仪表板 → 商品 → 创建

基本信息：
├─ 名称：可口可乐 330ML
├─ SKU：COKE-330ML
├─ 条形码：6901234567890
└─ 分类：饮料 → 碳酸饮料

单位组：
└─ 选择：计数单位组-24装 ← 重点！

单位配置：
┌────────────────────────────────┐
│ 规格 1：听装（零售）            │
│ ├─ 单位：件                    │
│ ├─ 条形码：6901234567891       │
│ ├─ 零售价：3.50                │
│ ├─ 批发价：2.80                │
│ └─ 库存：（留空）              │
│                                │
│ 规格 2：箱装（24听）            │
│ ├─ 单位：箱（24件装）          │
│ ├─ 条形码：6901234567892       │
│ ├─ 零售价：75.00               │
│ ├─ 批发价：60.00               │
│ └─ 库存：（留空）              │
└────────────────────────────────┘
```

#### 商品 2：可口可乐 500ML

```
基本信息：
├─ 名称：可口可乐 500ML
├─ SKU：COKE-500ML
├─ 条形码：6902345678900
└─ 分类：饮料 → 碳酸饮料

单位组：
└─ 选择：计数单位组-24装 ← 同样使用24装

单位配置：
┌────────────────────────────────┐
│ 规格 1：瓶装（零售）            │
│ ├─ 单位：件                    │
│ ├─ 条形码：6902345678901       │
│ ├─ 零售价：4.50                │
│ └─ 库存：（留空）              │
│                                │
│ 规格 2：箱装（24瓶）            │
│ ├─ 单位：箱（24件装）          │
│ ├─ 条形码：6902345678902       │
│ ├─ 零售价：95.00               │
│ └─ 库存：（留空）              │
└────────────────────────────────┘
```

#### 商品 3：可口可乐 2L

```
基本信息：
├─ 名称：可口可乐 2L
├─ SKU：COKE-2L
├─ 条形码：6903456789000
└─ 分类：饮料 → 碳酸饮料

单位组：
└─ 选择：计数单位组-8装 ← 使用8装！

单位配置：
┌────────────────────────────────┐
│ 规格 1：瓶装（零售）            │
│ ├─ 单位：件                    │
│ ├─ 条形码：6903456789001       │
│ ├─ 零售价：12.00               │
│ └─ 库存：（留空）              │
│                                │
│ 规格 2：箱装（8瓶）             │
│ ├─ 单位：箱（8件装）           │
│ ├─ 条形码：6903456789002       │
│ ├─ 零售价：85.00               │
│ └─ 库存：（留空）              │
└────────────────────────────────┘
```

### 第三步：采购入库

#### 采购单示例

```
仪表板 → 采购 → 创建采购单

供应商：可口可乐公司
日期：2026-01-24

商品列表：
┌──────────────────────────────────────┐
│ 商品 1：可口可乐 330ML               │
│ ├─ 单位：箱（24件装）                │
│ ├─ 数量：50 箱  ← 填写箱数          │
│ ├─ 采购价：60.00/箱                  │
│ └─ 小计：3000.00                     │
│                                      │
│ 系统自动计算：                       │
│ └─ 听装库存：+1200 听（50×24）      │
│                                      │
├──────────────────────────────────────┤
│ 商品 2：可口可乐 500ML               │
│ ├─ 单位：箱（24件装）                │
│ ├─ 数量：30 箱  ← 填写箱数          │
│ ├─ 采购价：75.00/箱                  │
│ └─ 小计：2250.00                     │
│                                      │
│ 系统自动计算：                       │
│ └─ 瓶装库存：+720 瓶（30×24）       │
│                                      │
├──────────────────────────────────────┤
│ 商品 3：可口可乐 2L                  │
│ ├─ 单位：箱（8件装）← 注意是8件/箱  │
│ ├─ 数量：20 箱  ← 填写箱数          │
│ ├─ 采购价：70.00/箱                  │
│ └─ 小计：1400.00                     │
│                                      │
│ 系统自动计算：                       │
│ └─ 瓶装库存：+160 瓶（20×8）        │
└──────────────────────────────────────┘

总计：6650.00
```

### 第四步：库存查看

#### 采购后的库存状态

**可口可乐 330ML**
```
听装（零售）：1200 听
箱装（批发）：50 箱
```

**可口可乐 500ML**
```
瓶装（零售）：720 瓶
箱装（批发）：30 箱
```

**可口可乐 2L**
```
瓶装（零售）：160 瓶
箱装（批发）：20 箱
```

### 第五步：销售场景

#### 场景 1：零售销售（拆箱销售）

**POS 收银台：**
```
扫描：6901234567891（330ML 听装）
数量：1 听
价格：3.50

结账后：
├─ 听装库存：1200 → 1199 听
└─ 箱装库存：50 箱（不变）
```

**说明**：听装和箱装库存是**独立管理**的！

#### 场景 2：批发销售（整箱销售）

**POS 收银台：**
```
扫描：6901234567892（330ML 箱装）
数量：5 箱
价格：75.00 × 5 = 375.00

结账后：
├─ 箱装库存：50 → 45 箱
└─ 听装库存：1199 听（不变）
```

#### 场景 3：拆箱补充零售库存

如果听装卖完了，需要从箱装拆出来：

```
商品列表 → 可口可乐 330ML → 操作 → 转换单位

源单位：箱（24件装）
目标单位：件（听装）
数量：10 箱

结果：
├─ 箱装库存：45 → 35 箱
└─ 听装库存：1199 → 1439 听（+240）
```

### 数据库结构

#### ns_units_groups（单位组）

```sql
id  name                description
1   计数单位组-24装      适用于 24 件/箱的商品
2   计数单位组-8装       适用于 8 件/箱的商品
```

#### ns_units（单位）

```sql
id  name           identifier  group_id  value  base_unit
1   件             PIECE       1         1      true
2   箱(24件装)     BOX24       1         24     false
3   件             PIECE_2L    2         1      true
4   箱(8件装)      BOX8        2         8      false
```

#### ns_products（商品）

```sql
id  name              unit_group  barcode
1   可口可乐 330ML    1           6901234567890
2   可口可乐 500ML    1           6902345678900
3   可口可乐 2L       2           6903456789000
```

#### ns_products_unit_quantities（库存）

```sql
-- 可口可乐 330ML
id  product_id  unit_id  quantity  barcode          sale_price
1   1           1        1200      6901234567891    3.50
2   1           2        50        6901234567892    75.00

-- 可口可乐 500ML
3   2           1        720       6902345678901    4.50
4   2           2        30        6902345678902    95.00

-- 可口可乐 2L
5   3           3        160       6903456789001    12.00
6   3           4        20        6903456789002    85.00
```

## 🎯 方案二：只管理单品库存（简化方案）

### 核心思路

**只按单品（听/瓶）管理库存，箱只是采购计量单位**

### 适用场景

- 不需要以整箱销售
- 只关心单品库存
- 简化库存管理

### 实施步骤

#### 第一步：创建单一单位组

```
单位组：计数单位组
├─ 单位 1：件（基础单位，value=1）
└─ （不创建"箱"单位）
```

#### 第二步：创建商品

**可口可乐 330ML**
```
单位组：计数单位组
单位配置：
└─ 件（听装）
   ├─ 条形码：6901234567891
   ├─ 零售价：3.50
   └─ 批发价（12听以上）：3.00
```

**可口可乐 500ML**
```
单位组：计数单位组
单位配置：
└─ 件（瓶装）
   ├─ 条形码：6902345678901
   └─ 零售价：4.50
```

**可口可乐 2L**
```
单位组：计数单位组
单位配置：
└─ 件（瓶装）
   ├─ 条形码：6903456789001
   └─ 零售价：12.00
```

#### 第三步：采购入库（手动换算）

```
采购单：

商品 1：可口可乐 330ML
├─ 单位：件
├─ 数量：1200  ← 手动计算：50箱 × 24 = 1200
├─ 采购价：2.50（60÷24）
└─ 小计：3000.00

商品 2：可口可乐 500ML
├─ 单位：件
├─ 数量：720  ← 手动计算：30箱 × 24 = 720
├─ 采购价：3.125（75÷24）
└─ 小计：2250.00

商品 3：可口可乐 2L
├─ 单位：件
├─ 数量：160  ← 手动计算：20箱 × 8 = 160
├─ 采购价：8.75（70÷8）
└─ 小计：1400.00
```

#### 优缺点

**优点：**
- ✅ 库存简单明了
- ✅ 只有一个库存数字
- ✅ 设置简单

**缺点：**
- ❌ 采购时需要手动计算
- ❌ 不能直接以整箱销售
- ❌ 不能查看箱装库存

## 🎯 方案三：混合方案（灵活但复杂）

### 核心思路

创建通用的计数单位组，但针对每个商品备注箱装数量

### 实施步骤

#### 单位组设置

```
计数单位组：
├─ 件（基础单位）
├─ 箱-小（24件/箱）
├─ 箱-中（12件/箱）
└─ 箱-大（8件/箱）
```

#### 商品配置

**可口可乐 330ML**
```
单位配置：
├─ 件（听装）
└─ 箱-小（24件装）
```

**可口可乐 500ML**
```
单位配置：
├─ 件（瓶装）
└─ 箱-小（24件装）
```

**可口可乐 2L**
```
单位配置：
├─ 件（瓶装）
└─ 箱-大（8件装）
```

## 📊 三种方案对比

| 特性 | 方案一：不同单位组 | 方案二：仅单品 | 方案三：混合 |
|------|-------------------|---------------|-------------|
| **库存管理** | 听/瓶和箱分别管理 | 只管理听/瓶 | 听/瓶和箱分别管理 |
| **设置复杂度** | ⭐⭐⭐ 中等 | ⭐ 简单 | ⭐⭐⭐⭐ 复杂 |
| **整箱销售** | ✅ 支持 | ❌ 不支持 | ✅ 支持 |
| **拆箱管理** | ✅ 转换单位 | ✅ 直接扣减 | ✅ 转换单位 |
| **采购录入** | ✅ 直接输入箱数 | ❌ 需手动计算 | ✅ 直接输入箱数 |
| **库存准确性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **推荐场景** | 需要批零兼营 | 纯零售 | 复杂批发业务 |

## 🎓 推荐方案总结

### 如果你的业务是：

**1. 批零兼营（零售+批发）**
→ 使用**方案一**：创建不同的单位组
- 可以整箱销售
- 可以拆零销售
- 库存清晰准确

**2. 纯零售（只拆零销售）**
→ 使用**方案二**：只管理单品
- 设置简单
- 库存统一
- 采购需换算

**3. 复杂批发（多种箱规格）**
→ 使用**方案三**：混合方案
- 灵活性最高
- 适应性强
- 设置较复杂

## 💡 实际操作建议

### 推荐：方案一 + 定期盘点

**日常操作：**
```
1. 采购：以箱为单位采购
   └─ 330ML：50箱（系统自动换算为1200听）

2. 零售：拆箱销售
   └─ 扫码卖听装（库存：1200→1199）

3. 批发：整箱销售
   └─ 扫码卖箱装（库存：50→49）

4. 拆箱补充：
   └─ 当听装库存不足时，转换单位

5. 定期盘点：
   └─ 核对实际箱数和听数
   └─ 使用库存调整功能修正
```

## 📝 完整操作示例

### 实战：设置可口可乐 330ML

#### 1. 创建单位组

```
访问：/dashboard/units/groups/create

名称：计数单位组-24装
描述：24件/箱的商品

保存后得到 ID：5
```

#### 2. 创建单位

**单位 1：件**
```
访问：/dashboard/units/create

名称：件
标识符：PIECE_24
单位组：计数单位组-24装
基础单位：✓
换算值：1

保存
```

**单位 2：箱（24件装）**
```
访问：/dashboard/units/create

名称：箱(24件装)
标识符：BOX24
单位组：计数单位组-24装
基础单位：✗
换算值：24

保存
```

#### 3. 创建商品

```
访问：/dashboard/products/create

【基本信息】
名称：可口可乐 330ML
SKU：COKE-330ML
条形码：6901234567890

【分类】
分类：饮料 → 碳酸饮料

【单位组】
单位组：计数单位组-24装 ← 选择刚创建的

【单位配置】
规格 1：
├─ 单位：件
├─ 条形码：6901234567891
├─ 零售价：3.50
└─ 批发价：2.80

规格 2：
├─ 单位：箱(24件装)
├─ 条形码：6901234567892
├─ 零售价：75.00
└─ 批发价：60.00

保存
```

#### 4. 采购入库

```
访问：/dashboard/procurements/create

供应商：可口可乐公司

添加商品：
├─ 商品：可口可乐 330ML
├─ 单位：箱(24件装) ← 选择箱
├─ 数量：50  ← 50箱
├─ 采购价：60.00
└─ 小计：3000.00

保存采购单

结果：
├─ 件（听装）库存：0 → 1200 听
└─ 箱装库存：0 → 50 箱
```

#### 5. POS 销售

**零售：**
```
扫描：6901234567891（听装）
数量：1
价格：3.50

库存变化：
├─ 听装：1200 → 1199
└─ 箱装：50（不变）
```

**批发：**
```
扫描：6901234567892（箱装）
数量：2
价格：75.00 × 2 = 150.00

库存变化：
├─ 听装：1199（不变）
└─ 箱装：50 → 48
```

## ⚠️ 常见错误

### 错误 1：共用同一个"箱"单位

❌ **错误做法：**
```
创建一个"箱"单位（value=24）
330ML、500ML、2L 都用这个箱
```

**问题：**
- 2L 是 8瓶/箱，不是 24瓶/箱
- 库存会计算错误

✅ **正确做法：**
- 为 2L 创建独立的单位组
- 创建"箱(8件装)"单位

### 错误 2：听装和箱装混在一起

❌ **错误做法：**
```
采购 50 箱，手动拆算为 1200 听
只在"听装"规格中填写 1200
```

**问题：**
- 无法整箱销售
- 不知道有多少整箱库存

✅ **正确做法：**
- 采购单选择"箱"单位，填 50
- 系统自动维护两个库存数字

### 错误 3：不使用单位转换

❌ **错误做法：**
```
听装卖完了，直接库存调整 +240
箱装手动 -10
```

**问题：**
- 没有转换记录
- 库存追溯困难

✅ **正确做法：**
- 使用"转换单位"功能
- 系统自动记录转换历史

## 📚 相关文档

- [商品创建与库存管理流程](商品创建与库存管理流程.md)
- [本地启动指南](本地启动指南.md)
- [库存管理系统完整指南](库存管理系统完整指南.md)

---

**最后更新**: 2026-01-24
**适用版本**: NexoPOS 5.x (Laravel 12.x)
