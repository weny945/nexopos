# 付款码支付功能 - 测试文档

## 文档信息

| 项目 | 信息 |
|-----|------|
| 文档名称 | 付款码支付功能测试文档 |
| 版本 | v1.0 |
| 创建日期 | 2026-01-25 |
| 测试环境 | 开发环境 |
| 测试范围 | 功能测试、集成测试、安全测试 |

---

## 目录

1. [测试环境准备](#1-测试环境准备)
2. [单元测试](#2-单元测试)
3. [API 接口测试](#3-api-接口测试)
4. [前端功能测试](#4-前端功能测试)
5. [集成测试](#5-集成测试)
6. [安全测试](#6-安全测试)
7. [性能测试](#7-性能测试)
8. [用户验收测试](#8-用户验收测试)
9. [测试用例](#9-测试用例)
10. [问题追踪](#10-问题追踪)

---

## 1. 测试环境准备

### 1.1 环境要求

| 组件 | 版本要求 | 当前版本 |
|-----|---------|---------|
| PHP | >= 8.2 | 8.2.x |
| MySQL | >= 5.7 / MariaDB >= 10.3 | - |
| Laravel | 12.x | 12.29.0 |
| Node.js | >= 18.x | - |
| NPM | >= 9.x | - |

### 1.2 数据库准备

```bash
# 1. 运行迁移
php artisan migrate

# 2. 运行 Seeder
php artisan db:seed --class=PaymentCodePaymentTypesSeeder

# 3. 验证表创建
php artisan tinker --execute='echo Schema::hasTable("nexopos_payment_code_transactions") ? "Table exists" : "Table not found";'

# 4. 验证支付类型
php artisan tinker --execute='use App\Models\PaymentType; echo PaymentType::whereIn("identifier", ["alipay-payment", "wechat-payment"]()->count();'
# 预期输出: 2
```

### 1.3 缓存清理

```bash
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear
```

### 1.4 服务启动

```bash
# 终端 1: 后端服务
php artisan serve

# 终端 2: 前端开发服务器
npm run dev

# 可选: 终端 3: 队列处理器
php artisan queue:work
```

---

## 2. 单元测试

### 2.1 模型测试

#### 测试文件: `tests/Unit/PaymentCodeTransactionTest.php`

```php
<?php

namespace Tests\Unit;

use App\Models\PaymentCodeTransaction;
use App\Models\Order;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PaymentCodeTransactionTest extends TestCase
{
    use RefreshDatabase;

    public function test_create_transaction()
    {
        $transaction = PaymentCodeTransaction::create([
            'order_id' => 1,
            'payment_type' => 'alipay',
            'payment_code' => encrypt('123456789012345678'),
            'amount' => 50.00,
            'status' => 'pending',
            'author' => 1,
        ]);

        $this->assertDatabaseHas('nexopos_payment_code_transactions', [
            'order_id' => 1,
            'payment_type' => 'alipay',
            'amount' => 50.00,
        ]);
    }

    public function test_alipay_scope()
    {
        PaymentCodeTransaction::create([
            'order_id' => 1,
            'payment_type' => 'alipay',
            'payment_code' => encrypt('123456789012345678'),
            'amount' => 50.00,
            'author' => 1,
        ]);

        $transactions = PaymentCodeTransaction::alipay()->get();
        $this->assertCount(1, $transactions);
    }

    public function test_wechat_scope()
    {
        PaymentCodeTransaction::create([
            'order_id' => 1,
            'payment_type' => 'wechat',
            'payment_code' => encrypt('123456789012345678'),
            'amount' => 50.00,
            'author' => 1,
        ]);

        $transactions = PaymentCodeTransaction::wechat()->get();
        $this->assertCount(1, $transactions);
    }

    public function test_success_scope()
    {
        PaymentCodeTransaction::create([
            'order_id' => 1,
            'payment_type' => 'alipay',
            'payment_code' => encrypt('123456789012345678'),
            'amount' => 50.00,
            'status' => 'success',
            'author' => 1,
        ]);

        $transactions = PaymentCodeTransaction::success()->get();
        $this->assertCount(1, $transactions);
    }

    public function test_masked_payment_code_accessor()
    {
        $transaction = new PaymentCodeTransaction([
            'payment_code' => encrypt('123456789012345678'),
        ]);

        $this->assertEquals('**** **** **** 6789', $transaction->masked_payment_code);
    }
}
```

#### 运行测试

```bash
php artisan test tests/Unit/PaymentCodeTransactionTest.php
```

### 2.2 服务层测试

#### 测试文件: `tests/Unit/PaymentCodeServiceTest.php`

```php
<?php

namespace Tests\Unit;

use App\Services\PaymentCodeService;
use App\Exceptions\NotFoundException;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PaymentCodeServiceTest extends TestCase
{
    use RefreshDatabase;

    protected $service;

    protected function setUp(): void
    {
        parent::setUp();
        $this->service = app()->make(PaymentCodeService::class);
    }

    public function test_validate_payment_code_valid()
    {
        $result = $this->service->validatePaymentCode('1234567890', 'alipay');
        $this->assertTrue($result);
    }

    public function test_validate_payment_code_invalid_too_short()
    {
        $this->expectException(\Exception::class);
        $this->service->validatePaymentCode('123', 'alipay');
    }

    public function test_validate_payment_code_invalid_too_long()
    {
        $this->expectException(\Exception::class);
        $this->service->validatePaymentCode('123456789012345678901', 'alipay');
    }

    public function test_validate_payment_code_invalid_format()
    {
        $this->expectException(\Exception::class);
        $this->service->validatePaymentCode('abcdefghijklmn', 'alipay');
    }

    public function test_create_transaction()
    {
        $transaction = $this->service->createTransaction([
            'order_id' => 1,
            'payment_type' => 'alipay',
            'payment_code' => encrypt('1234567890'),
            'amount' => 50.00,
            'author' => 1,
        ]);

        $this->assertInstanceOf(\App\Models\PaymentCodeTransaction::class, $transaction);
        $this->assertEquals('pending', $transaction->status);
    }

    public function test_get_transaction_not_found()
    {
        $this->expectException(NotFoundException::class);
        $this->service->getTransaction(999999);
    }

    public function test_encrypt_decrypt_payment_code()
    {
        $originalCode = '123456789012345678';
        $encrypted = $this->service->encryptPaymentCode($originalCode);
        $decrypted = $this->service->decryptPaymentCode($encrypted);

        $this->assertEquals($originalCode, $decrypted);
    }
}
```

#### 运行测试

```bash
php artisan test tests/Unit/PaymentCodeServiceTest.php
```

---

## 3. API 接口测试

### 3.1 功能测试文件

**位置**: `tests/Feature/PaymentCodeApiTest.php`

```php
<?php

namespace Tests\Feature;

use App\Models\PaymentCodeTransaction;
use App\Models\Order;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PaymentCodeApiTest extends TestCase
{
    use RefreshDatabase;

    protected $user;

    protected function setUp(): void
    {
        parent::setUp();
        $this->user = User::factory()->create();
        $this->actingAs($this->user);
    }

    public function test_get_config()
    {
        $response = $this->getJson('/api/payment-codes/config');

        $response->assertStatus(200)
            ->assertJsonStructure([
                'status',
                'data' => [
                    'alipay' => [
                        'enabled',
                        'app_id',
                        'has_config',
                    ],
                    'wechat' => [
                        'enabled',
                        'mch_id',
                        'has_config',
                    ],
                ],
            ]);
    }

    public function test_process_payment_invalid_code()
    {
        $response = $this->postJson('/api/payment-codes/pay', [
            'order_id' => 1,
            'payment_type' => 'alipay-payment',
            'payment_code' => '123', // 太短
            'amount' => 50.00,
        ]);

        $response->assertStatus(422);
    }

    public function test_process_payment_missing_fields()
    {
        $response = $this->postJson('/api/payment-codes/pay', [
            'order_id' => 1,
            // 缺少 payment_type
            'payment_code' => '1234567890',
            'amount' => 50.00,
        ]);

        $response->assertStatus(422);
    }

    public function test_get_transactions_pagination()
    {
        PaymentCodeTransaction::factory()->count(20)->create([
            'payment_type' => 'alipay',
        ]);

        $response = $this->getJson('/api/payment-codes/transactions?per_page=10');

        $response->assertStatus(200)
            ->assertJsonStructure([
                'data' => [
                    'current_page',
                    'data',
                    'per_page',
                    'total',
                ],
            ]);

        $data = $response->json('data');
        $this->assertCount(10, $data['data']);
    }
}
```

### 3.2 API 测试清单

| 接口 | 测试项 | 预期结果 |
|-----|--------|---------|
| GET /api/payment-codes/config | 返回配置 | 200 + JSON |
| POST /api/payment-codes/config/test | 测试连接 | 200 + success |
| POST /api/payment-codes/pay | 处理支付 | 200 + success/error |
| GET /api/payment-codes/transactions | 获取交易列表 | 200 + 分页数据 |
| GET /api/payment-codes/transactions/{id} | 获取单条记录 | 200 + 数据 |
| POST /api/payment-codes/notify/alipay | 支付宝回调 | success |
| POST /api/payment-codes/notify/wechat | 微信回调 | JSON |

---

## 4. 前端功能测试

### 4.1 组件测试

#### 测试文件: `resources/js/tests/payment-code.test.js`

```javascript
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { mount } from '@vue/test-utils';
import { createPinia } from 'pinia';
import AlipayPayment from '~/pages/dashboard/pos/payments/alipay-payment.vue';

describe('AlipayPayment Component', () => {
    let wrapper;
    let pinia;

    beforeEach(() => {
        pinia = createPinia();

        // Mock POS 对象
        global.POS = {
            order: {
                subscribe: (callback) => ({
                    unsubscribe: () => {},
                }),
                getValue: () => ({
                    id: 1,
                    total: 100.00,
                    tendered: 0,
                    change: 0,
                }),
            },
            addPayment: vi.fn(),
        };

        // Mock nsHttpClient
        global.nsHttpClient = {
            post: vi.fn(() => Promise.resolve({
                status: 'success',
                message: 'Payment successful',
            })),
        };

        // Mock nsSnackBar
        global.nsSnackBar = {
            success: vi.fn(),
            error: vi.fn(),
        };

        wrapper = mount(AlipayPayment, {
            global: {
                plugins: [pinia],
                provide: {
                    POS: global.POS,
                },
            },
        });
    });

    it('should render payment form', () => {
        expect(wrapper.find('#details').exists()).toBe(true);
        expect(wrapper.find('#payment-status').exists()).toBe(true);
        expect(wrapper.find('input[type="text"]').exists()).toBe(true);
    });

    it('should validate payment code format', async () => {
        const input = wrapper.find('input[type="text"]');

        // 输入无效代码
        await input.setValue('123');
        expect(wrapper.vm.isValidCode).toBe(false);

        // 输入有效代码
        await input.setValue('123456789012345678');
        expect(wrapper.vm.isValidCode).toBe(true);
    });

    it('should format payment code for display', async () => {
        const input = wrapper.find('input[type="text"]');
        await input.setValue('123456789012345678');

        expect(wrapper.vm.maskedCode).toBe('1234 5678 9012 3456 78');
    });

    it('should clear payment code', async () => {
        const input = wrapper.find('input[type="text"]');
        await input.setValue('123456789012345678');

        const clearButton = wrapper.find('button').filter(button =>
            button.text().includes('Clear')
        );
        await clearButton.trigger('click');

        expect(wrapper.vm.paymentCode).toBe('');
    });

    it('should disable button when code is invalid', () => {
        const submitButton = wrapper.find('button').filter(button =>
            button.text().includes('Confirm Payment')
        );

        expect(submitButton.attributes('disabled')).toBeTruthy();
    });
});
```

### 4.2 前端测试检查清单

| 测试项 | 说明 | 测试方法 |
|-------|------|---------|
| 组件渲染 | 组件是否正确显示 | 目测检查 |
| 输入验证 | 付款码格式验证 | 输入不同长度代码 |
| 计算属性 | maskedCode 格式化 | 检查输出格式 |
| 事件触发 | 点击按钮触发方法 | 模拟点击 |
| API 调用 | HTTP 请求是否正确 | Mock API |
| 错误处理 | 显示错误信息 | 测试失败场景 |
| 成功处理 | 完成支付流程 | 测试成功场景 |

---

## 5. 集成测试

### 5.1 端到端测试流程

#### 测试场景 1: 完整支付流程（成功）

```php
<?php

namespace Tests\Feature;

use App\Models\Customer;
use App\Models\Order;
use App\Models\Product;
use App\Models\ProductCategory;
use App\Models\ProductUnitQuantity;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PaymentCodeE2ETest extends TestCase
{
    use RefreshDatabase;

    protected $user;

    protected function setUp(): void
    {
        parent::setUp();
        $this->user = User::factory()->admin()->create();
    }

    public function test_complete_payment_flow()
    {
        $this->actingAs($this->user);

        // 1. 创建测试订单
        $order = Order::create([
            'total' => 50.00,
            'tendered' => 0,
            'change' => 0,
            'payment_status' => 'unpaid',
            'author' => $this->user->id,
        ]);

        // 2. 发起支付请求（模拟）
        $paymentCode = '287654321012345678'; // 模拟付款码

        $response = $this->postJson('/api/payment-codes/pay', [
            'order_id' => $order->id,
            'payment_type' => 'alipay-payment',
            'payment_code' => $paymentCode,
            'amount' => 50.00,
        ]);

        // 3. 验证响应
        // 注意：实际环境会调用真实网关，测试环境需要 Mock

        $response->assertStatus(200);

        // 4. 验证交易记录创建
        $this->assertDatabaseHas('nexopos_payment_code_transactions', [
            'order_id' => $order->id,
            'payment_type' => 'alipay',
            'amount' => 50.00,
        ]);
    }
}
```

### 5.2 集成测试场景

| 场景 | 前置条件 | 操作 | 预期结果 |
|-----|---------|------|---------|
| 支付成功 | 有效付款码 | 扫描付款码 → 确认 | 订单状态更新，交易记录创建 |
| 支付失败 | 无效付款码 | 扫描付款码 → 确认 | 显示错误信息，订单不变 |
| 余额不足 | 模拟余额不足 | 扫描付款码 → 确认 | 显示"余额不足" |
| 付款码过期 | 过期付款码 | 扫描付款码 → 确认 | 显示"付款码过期" |
| 网络超时 | 模拟超时 | 扫描付款码 → 确认 | 显示"网络错误，请重试" |

---

## 6. 安全测试

### 6.1 签名验证测试

```php
<?php

namespace Tests\Security;

use Tests\TestCase;
use Illuminate\Support\Facades\Http;

class SignatureVerificationTest extends TestCase
{
    public function test_alipay_callback_signature_verification()
    {
        // 构造伪造签名的回调
        $fakeData = [
            'app_id' => 'fake_app_id',
            'trade_no' => 'fake_trade_no',
            'out_trade_no' => 'ORDER-123',
            'total_amount' => '50.00',
            'sign' => 'fake_signature',
        ];

        $response = $this->postJson('/api/payment-codes/notify/alipay', $fakeData);

        // 应该返回失败
        $response->assertStatus(400);
    }

    public function test_wechat_callback_signature_verification()
    {
        $fakeData = [
            'id' => 'fake_id',
            'create_time' => time(),
            'resource_type' => 'encrypt-resource',
            'event_type' => 'TRANSACTION.SUCCESS',
            'resource' => [
                'algorithm' => 'AEAD_AES_256_GCM',
                'ciphertext' => 'fake_data',
                'nonce' => 'fake_nonce',
                'associated_data' => 'fake_data',
            ],
            'signature' => 'fake_signature',
        ];

        $response = $this->postJson('/api/payment-codes/notify/wechat', $fakeData);

        // 应该返回失败
        $response->assertStatus(400);
    }
}
```

### 6.2 安全测试清单

| 测试项 | 说明 | 测试方法 |
|-------|------|---------|
| SQL 注入防护 | 测试参数化查询 | 输入 `1' OR '1'='1` |
| XSS 防护 | 测试输入过滤 | 输入 `<script>alert('x')</script>` |
| CSRF 保护 | 测试 CSRF token | 缺少 token 的请求 |
| 签名验证 | 测试伪造签名 | 发送伪造签名的回调 |
| 权限控制 | 测试未授权访问 | 未登录用户访问 |
| 数据加密 | 测试敏感数据加密 | 检查数据库中的付款码 |

---

## 7. 性能测试

### 7.1 响应时间测试

```bash
# 使用 Apache Bench 进行压力测试
ab -n 100 -c 10 http://localhost:8000/api/payment-codes/config

# 测试支付接口（需要先登录获取 token）
curl -X POST http://localhost:8000/api/payment-codes/pay \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"order_id":1,"payment_type":"alipay-payment","payment_code":"123456789012345678","amount":50}' \
  -w "@curl-format.txt" \
  -o output.txt
```

### 7.2 性能指标

| 指标 | 目标值 | 测试方法 |
|-----|--------|---------|
| API 响应时间 | < 200ms | JMeter / Apache Bench |
| 支付处理时间 | < 3s | 实际测试 |
| 数据库查询 | < 100ms | Laravel Debugbar |
| 内存使用 | < 128MB | Laravel Telescope |
| 并发处理 | 支持 50 QPS | JMeter |

---

## 8. 用户验收测试 (UAT)

### 8.1 UAT 测试场景

#### 场景 1: 配置支付宝支付

**步骤**：
1. 登录后台管理系统
2. 导航到：设置 → POS 设置 → Payment Codes
3. 勾选"启用支付宝付款码"
4. 填写应用ID、私钥、公钥
5. 点击"测试连接"按钮
6. 查看测试结果

**预期结果**：
- 配置保存成功
- 测试连接显示"成功"
- 支付宝支付在 POS 中可见

#### 场景 2: POS 支付流程

**步骤**：
1. 登录 POS 系统
2. 添加商品到购物车
3. 点击"支付"按钮
4. 选择"支付宝"
5. 扫描顾客出示的付款码
6. 点击"确认支付"
7. 等待支付结果
8. 打印小票

**预期结果**：
- 付款码自动识别
- 支付请求发送成功
- 显示支付结果
- 订单状态更新
- 小票正确打印

### 8.2 UAT 测试清单

| # | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|---|---------|---------|---------|------|
| 1 | 配置支付宝 | 配置参数 → 测试连接 | 显示成功 | ⬜ 待测试 |
| 2 | 配置微信支付 | 配置参数 → 测试连接 | 显示成功 | ⬜ 待测试 |
| 3 | 支付宝收款 | 扫码 → 确认 → 完成 | 支付成功 | ⬜ 待测试 |
| 4 | 微信收款 | 扫码 → 确认 → 完成 | 支付成功 | ⬜ 待测试 |
| 5 | 无效付款码 | 输入无效码 → 确认 | 显示错误 | ⬜ 待测试 |
| 6 | 查看交易记录 | 导航到交易记录 | 显示列表 | ⬜ 待测试 |

---

## 9. 测试用例

### 9.1 功能测试用例

#### TC-001: 支付码格式验证

| 字段 | 值 |
|-----|-----|
| 用例ID | TC-001 |
| 测试项 | 支付码格式验证 |
| 前置条件 | 打开支付页面 |
| 测试步骤 | 1. 输入 9 位数字<br>2. 输入 19 位数字<br>3. 输入 10-18 位数字<br>4. 输入包含字母 |
| 预期结果 | 1. 提示"格式无效"<br>2. 提示"格式无效"<br>3. 通过验证<br>4. 提示"格式无效" |
| 优先级 | 高 |
| 状态 | ⬜ 待测试 |

#### TC-002: 支付宝支付成功流程

| 字段 | 值 |
|-----|-----|
| 用例ID | TC-002 |
| 测试项 | 支付宝支付成功 |
| 前置条件 | 1. 配置完成<br>2. 有效付款码 |
| 测试步骤 | 1. 添加商品<br>2. 点击支付<br>3. 选择支付宝<br>4. 扫描付款码<br>5. 确认支付 |
| 预期结果 | 显示"支付成功"，订单更新，交易记录创建 |
| 优先级 | 高 |
| 状态 | ⬜ 待测试 |

#### TC-003: 微信支付成功流程

| 字段 | 值 |
|-----|-----|
| 用例ID | TC-003 |
| 测试项 | 微信支付成功 |
| 前置条件 | 1. 配置完成<br>2. 有效付款码 |
| 测试步骤 | 1. 添加商品<br>2. 点击支付<br>3. 选择微信支付<br>4. 扫描付款码<br>5. 确认支付 |
| 预期结果 | 显示"支付成功"，订单更新，交易记录创建 |
| 优先级 | 高 |
| 状态 | ⬜ 待测试 |

### 9.2 异常测试用例

#### TC-101: 余额不足

| 字段 | 值 |
|-----|-----|
| 用例ID | TC-101 |
| 测试项 | 余额不足处理 |
| 测试步骤 | 使用余额不足的付款码支付 |
| 预期结果 | 显示"余额不足"，订单不更新 |
| 状态 | ⬜ 待测试 |

#### TC-102: 付款码过期

| 字段 | 值 |
|-----|-----|
| 用例ID | TC-102 |
| 测试项 | 付款码过期处理 |
| 测试步骤 | 使用过期的付款码支付 |
| 预期结果 | 显示"付款码过期"，提示刷新 |
| 状态 | ⬜ 待测试 |

#### TC-103: 网络超时

| 字段 | 值 |
|-----|-----|
| 用例ID | TC-103 |
| 测试项 | 网络超时处理 |
| 测试步骤 | 模拟网络超时 |
| 预期结果 | 显示"网络错误，请重试"，支持重试 |
| 状态 | ⬜ 待测试 |

---

## 10. 问题追踪

### 10.1 Bug 报告模板

```
Bug ID: BUG-001
标题: [简短描述]
严重程度: [Critical/High/Medium/Low]
环境: [开发/测试/生产]
发现人: [姓名]
发现日期: [2026-01-25]

问题描述:
[详细描述问题]

重现步骤:
1. [步骤1]
2. [步骤2]
3. [步骤3]

预期结果:
[应该发生什么]

实际结果:
[实际发生了什么]

附件:
[截图、日志]

优先级: [P0/P1/P2/P3]
```

### 10.2 测试日志模板

```
测试日志 - 付款码支付功能

测试日期: [2026-01-25]
测试人员: [姓名]
测试环境: [开发/测试]

测试执行记录:

[ ] 单元测试
    [ ] 模型测试 - 10/10 通过
    [ ] 服务层测试 - 8/10 通过
    [ ] 备注: [失败原因]

[ ] API 接口测试
    [ ] 配置获取 - 通过
    [ ] 连接测试 - 通过
    [ ] 支付处理 - 通过
    [ ] 交易查询 - 通过
    [ ] 备注: []

[ ] 前端功能测试
    [ ] 支付宝组件 - 通过
    [ ] 微信组件 - 通过
    [ ] 备注: []

[ ] 集成测试
    [ ] 完整支付流程 - 通过
    [ ] 错误处理 - 通过
    [ ] 备注: []

[ ] 安全测试
    [ ] 签名验证 - 通过
    [ ] 权限控制 - 通过
    [ ] 备注: []

问题列表:
1. [问题描述] - [严重程度] - [状态]

总结:
[整体评估]
```

### 10.3 测试报告

#### 测试覆盖率

| 模块 | 测试用例数 | 通过 | 失败 | 覆盖率 |
|-----|-----------|------|------|--------|
| 模型层 | 5 | - | - | -% |
| 服务层 | 8 | - | - | -% |
| 控制器 | 7 | - | - | -% |
| 前端组件 | 6 | - | - | -% |
| 安全 | 6 | - | - | -% |
| 总计 | 32 | - | - | -% |

---

## 附录

### A. 测试数据准备

```php
<?php

// 测试用订单数据
$testOrder = [
    'total' => 100.50,
    'tendered' => 0,
    'change' => 0,
    'payment_status' => 'unpaid',
    'type' => 'takeaway',
    'author' => 1,
];

// 测试付款码
$testPaymentCodes = [
    'valid_alipay' => '287654321012345678',
    'valid_wechat' => '134567890123456789',
    'invalid_short' => '12345',
    'invalid_long' => '123456789012345678901',
    'invalid_format' => 'abcdefghijklmn',
];
```

### B. Mock 数据

```php
// Mock 支付宝响应
$mockAlipaySuccessResponse = [
    'alipay_trade_pay_response' => [
        'code' => '10000',
        'msg' => 'Success',
        'trade_no' => '2026012522001412341234567890',
        'out_trade_no' => 'ORDER-123-1706185823',
    ],
];

// Mock 微信支付响应
$mockWeChatSuccessResponse = [
    'id' => '4200001234567890123456789012',
    'create_time' => '2026-01-25T12:34:56+08:00',
    'resource_type' => 'encrypt-resource',
    'event_type' => 'TRANSACTION.SUCCESS',
    'resource' => [
        'transaction_id' => '4200001234567890123456789012',
        'amount' => [
            'total' => 50,
            'currency' => 'CNY',
        ],
    ],
];
```

---

**文档版本**: v1.0
**最后更新**: 2026-01-25
**测试负责人**: 测试团队
